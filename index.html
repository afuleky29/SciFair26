<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Roboflow Workflow (URL + File + Webcam)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }
        #preview {
            width: 300px;
            display: none;
            margin-top: 20px;
            border-radius: 6px;
        }
        #output {
            background: #f2f2f2;
            padding: 15px;
            margin-top: 20px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        #webcamContainer video {
            width: 300px;
            border-radius: 6px;
            display: none;
        }
    </style>
</head>
<body>

<h1>Roboflow Classifier Demo</h1>

<h3>Choose Input Method:</h3>

<button onclick="selectURL()">Use URL</button>
<button onclick="selectFile()">Upload File</button>
<button onclick="selectWebcam()">Use Webcam</button>

<br><br>

<!-- URL INPUT -->
<div id="urlInput" style="display:none;">
    <input id="imageUrl" type="text" size="60" placeholder="Enter image URL">
    <button onclick="runURL()">Run with URL</button>
</div>

<!-- FILE INPUT -->
<div id="fileInput" style="display:none;">
    <input type="file" id="filePicker" accept="image/*">
    <button onclick="runFile()">Run with File</button>
</div>

<!-- WEBCAM INPUT -->
<div id="webcamContainer" style="display:none;">
    <video id="webcam" autoplay playsinline></video>
    <br>
    <button onclick="captureWebcam()">Capture & Run</button>
</div>

<img id="preview">
<div id="output"></div>

<script>
const BACKEND_URL = "https://scifair-backend.onrender.com/infer";

/* ---------- UI ---------- */
function hideAll() {
  ["urlInput","fileInput","webcamContainer"].forEach(
    id => document.getElementById(id).style.display = "none"
  );
}

function selectURL() {
  hideAll();
  document.getElementById("urlInput").style.display = "block";
}

function selectFile() {
  hideAll();
  document.getElementById("fileInput").style.display = "block";
}

async function selectWebcam() {
  hideAll();
  const container = document.getElementById("webcamContainer");
  container.style.display = "block";

  const video = document.getElementById("webcam");
  video.srcObject = await navigator.mediaDevices.getUserMedia({ video: true });
}

/* ---------- SEND TO BACKEND ---------- */
async function send(image) {
  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ image })
  });

  const data = await res.json();
  document.getElementById("output").textContent =
    JSON.stringify(data, null, 2);
}

/* ---------- URL ---------- */
function runURL() {
  const url = document.getElementById("imageUrl").value.trim();
  if (!url) return alert("Enter a URL");

  document.getElementById("preview").src = url;
  document.getElementById("preview").style.display = "block";
  send(url);
}

/* ---------- FILE ---------- */
function runFile() {
  const file = document.getElementById("filePicker").files[0];
  if (!file) return alert("Choose a file");

  const reader = new FileReader();
  reader.onload = () => {
    document.getElementById("preview").src = reader.result;
    document.getElementById("preview").style.display = "block";
    send(reader.result);
  };
  reader.readAsDataURL(file);
}

/* ---------- WEBCAM ---------- */
function captureWebcam() {
  const video = document.getElementById("webcam");
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  canvas.getContext("2d").drawImage(video, 0, 0);
  const base64 = canvas.toDataURL("image/jpeg");

  document.getElementById("preview").src = base64;
  document.getElementById("preview").style.display = "block";
  send(base64);
}
</script>

</body>
</html>
