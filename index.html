<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roboflow Classifier</title>
</head>

<body>

<h1>Roboflow Classifier</h1>

<input id="imageUrl" size="60" placeholder="Image URL">
<button onclick="runURL()">Run URL</button>

<br><br>

<input type="file" id="filePicker">
<button onclick="runFile()">Run File</button>

<br><br>

<button onclick="startCamera()">Start Camera</button>
<button onclick="captureWebcam()">Capture</button>

<br><br>

<video id="webcam" autoplay playsinline style="display:none;width:300px;"></video>
<img id="preview" style="display:none;width:300px;">
<pre id="output"></pre>

<script>
const BACKEND_URL = "https://scifair-backend.onrender.com";

/* URL */
async function runURL() {
  const url = imageUrl.value.trim();
  if (!url) return alert("Enter URL");

  preview.src = url;
  preview.style.display = "block";

  sendJSON({ url });
}

/* FILE */
async function runFile() {
  const file = filePicker.files[0];
  if (!file) return alert("Pick file");

  const fd = new FormData();
  fd.append("file", file);

  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";

  const res = await fetch(BACKEND_URL, { method: "POST", body: fd });
  show(res);
}

/* CAMERA */
let stream;
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  webcam.srcObject = stream;
  webcam.style.display = "block";
}

async function captureWebcam() {
  const canvas = document.createElement("canvas");
  canvas.width = webcam.videoWidth;
  canvas.height = webcam.videoHeight;
  canvas.getContext("2d").drawImage(webcam, 0, 0);

  const base64 = canvas.toDataURL("image/jpeg");
  preview.src = base64;
  preview.style.display = "block";

  sendJSON({ base64 });
}

/* HELPERS */
async function sendJSON(data) {
  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  show(res);
}

async function show(res) {
  const json = await res.json();
  output.textContent = JSON.stringify(json, null, 2);
}
</script>

</body>
</html>
