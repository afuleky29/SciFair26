<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Roboflow Demo</title>
</head>
<body>

<h2>Roboflow Classifier</h2>

<!-- URL -->
<input id="url" size="60" placeholder="Image URL">
<button onclick="runURL()">Run URL</button>

<br><br>

<!-- FILE -->
<input type="file" id="file">
<button onclick="runFile()">Run File</button>

<br><br>

<!-- WEBCAM -->
<video id="video" autoplay width="300"></video>
<br>
<button onclick="startCam()">Start Camera</button>
<button onclick="runCam()">Capture</button>

<pre id="out"></pre>

<script>
const BACKEND = "https://scifair-backend.onrender.com/";

async function runURL() {
  const image = document.getElementById("url").value;
  const res = await fetch(BACKEND, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ image })
  });
  document.getElementById("out").textContent =
    JSON.stringify(await res.json(), null, 2);
}

async function runFile() {
  const f = document.getElementById("file").files[0];
  const fd = new FormData();
  fd.append("file", f);

  const res = await fetch(BACKEND, {
    method: "POST",
    body: fd
  });
  document.getElementById("out").textContent =
    JSON.stringify(await res.json(), null, 2);
}

async function startCam() {
  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  document.getElementById("video").srcObject = stream;
}

async function runCam() {
  const v = document.getElementById("video");
  const c = document.createElement("canvas");
  c.width = v.videoWidth;
  c.height = v.videoHeight;
  c.getContext("2d").drawImage(v,0,0);
  const base64 = c.toDataURL("image/jpeg");

  const res = await fetch(BACKEND, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ base64 })
  });

  document.getElementById("out").textContent =
    JSON.stringify(await res.json(), null, 2);
}
</script>

</body>
</html>
