<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Roboflow Demo</title>
</head>
<body>

<h2>Roboflow Classifier</h2>

<!-- URL -->
<input id="url" size="60" placeholder="Image URL">
<button onclick="runURL()">Run URL</button>

<br><br>

<!-- FILE -->
<input type="file" id="file">
<button onclick="runFile()">Run File</button>

<br><br>

<!-- WEBCAM -->
<video id="video" autoplay width="300"></video>
<br>
<button onclick="startCam()">Start Camera</button>
<button onclick="runCam()">Capture</button>

<pre id="out"></pre>

<script>
const BACKEND_URL = "https://scifair-backend.onrender.com";

/* ---------- UI HELPERS ---------- */
function hideAll() {
  document.getElementById("urlInput").style.display = "none";
  document.getElementById("fileInput").style.display = "none";
  document.getElementById("webcamContainer").style.display = "none";
}

function selectURL() {
  hideAll();
  document.getElementById("urlInput").style.display = "block";
}

function selectFile() {
  hideAll();
  document.getElementById("fileInput").style.display = "block";
}

async function selectWebcam() {
  hideAll();
  document.getElementById("webcamContainer").style.display = "block";

  const video = document.getElementById("webcam");
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
}

/* ---------- RUN URL ---------- */
async function runURL() {
  const url = document.getElementById("imageUrl").value.trim();
  if (!url) return alert("Enter an image URL");

  document.getElementById("preview").src = url;
  document.getElementById("preview").style.display = "block";

  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      image: {
        type: "url",
        value: url
      }
    })
  });

  const data = await res.json();
  showResult(data);
}

/* ---------- RUN FILE ---------- */
async function runFile() {
  const file = document.getElementById("filePicker").files[0];
  if (!file) return alert("Choose a file first");

  const formData = new FormData();
  formData.append("file", file);

  document.getElementById("preview").src = URL.createObjectURL(file);
  document.getElementById("preview").style.display = "block";

  const res = await fetch(BACKEND_URL, {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  showResult(data);
}

/* ---------- RUN WEBCAM ---------- */
async function captureWebcam() {
  const video = document.getElementById("webcam");

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);

  const base64 = canvas.toDataURL("image/jpeg").split(",")[1];

  document.getElementById("preview").src = canvas.toDataURL("image/jpeg");
  document.getElementById("preview").style.display = "block";

  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      image: {
        type: "base64",
        value: base64
      }
    })
  });

  const data = await res.json();
  showResult(data);
}

/* ---------- DISPLAY RESULT ---------- */
function showResult(data) {
  document.getElementById("output").textContent =
    JSON.stringify(data, null, 2);
}
</script>

</body>
</html>
