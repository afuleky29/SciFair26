<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Roboflow Workflow (URL + File + Webcam)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }
        #preview {
            width: 300px;
            display: none;
            margin-top: 20px;
            border-radius: 6px;
        }
        #output {
            background: #f2f2f2;
            padding: 15px;
            margin-top: 20px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        #webcamContainer video {
            width: 300px;
            border-radius: 6px;
            display: none;
        }
    </style>
</head>
<body>

<h1>Roboflow Classifier Demo</h1>

<h3>Choose Input Method:</h3>

<button onclick="selectURL()">Use URL</button>
<button onclick="selectFile()">Upload File</button>
<button onclick="selectWebcam()">Use Webcam</button>

<br><br>

<!-- URL INPUT -->
<div id="urlInput" style="display:none;">
    <input id="imageUrl" type="text" size="60" placeholder="Enter image URL">
    <button onclick="runURL()">Run with URL</button>
</div>

<!-- FILE INPUT -->
<div id="fileInput" style="display:none;">
    <input type="file" id="filePicker" accept="image/*">
    <button onclick="runFile()">Run with File</button>
</div>

<!-- WEBCAM INPUT -->
<div id="webcamContainer" style="display:none;">
    <video id="webcam" autoplay playsinline></video>
    <br>
    <button onclick="captureWebcam()">Capture & Run</button>
</div>

<img id="preview">
<div id="output"></div>

<script>

    // UI controls
    function hideAll() {
        document.getElementById("urlInput").style.display = "none";
        document.getElementById("fileInput").style.display = "none";
        document.getElementById("webcamContainer").style.display = "none";
        document.getElementById("webcam").style.display = "none";
    }

    function selectURL() {
        hideAll();
        document.getElementById("urlInput").style.display = "block";
    }

    function selectFile() {
        hideAll();
        document.getElementById("fileInput").style.display = "block";
    }

    async function selectWebcam() {
        hideAll();
        document.getElementById("webcamContainer").style.display = "block";

        const video = document.getElementById("webcam");
        video.style.display = "block";

        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
    }

    // Run workflow using URL
    async function runURL() {
        const url = document.getElementById("imageUrl").value.trim();
        if (!url) return alert("Enter a valid URL.");

        document.getElementById("preview").src = url;
        document.getElementById("preview").style.display = "block";

        sendToRoboflow({ type: "url", value: url });
    }

    // Run workflow using File Upload
    async function runFile() {
        const file = document.getElementById("filePicker").files[0];
        if (!file) return alert("Choose a file first.");

        const reader = new FileReader();
        reader.onload = () => {
            const base64 = reader.result;
            document.getElementById("preview").src = base64;
            document.getElementById("preview").style.display = "block";

            sendToRoboflow({ type: "base64", value: base64 });
        };
        reader.readAsDataURL(file);
    }

    // Run workflow using Webcam
    async function captureWebcam() {
        const video = document.getElementById("webcam");

        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0);

        const base64 = canvas.toDataURL("image/jpeg");

        document.getElementById("preview").src = base64;
        document.getElementById("preview").style.display = "block";

        sendToRoboflow({ type: "base64", value: base64 });
    }

    // Send request to Roboflow Workflow
    async function sendToRoboflow(imgInput) {
        const response = await fetch(WORKFLOW_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                api_key: API_KEY,
                inputs: { image: imgInput }
            })
        });

        const result = await response.json();
        document.getElementById("output").textContent =
            JSON.stringify(result, null, 2);
    }
    async function run() {
      const image = document.getElementById("imageUrl").value;

      const res = await fetch("https://scifair-backend.onrender.com", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image })
      });

      const data = await res.json();
      document.getElementById("output").textContent =
        JSON.stringify(data, null, 2);
    }
</script>

</body>
</html>
